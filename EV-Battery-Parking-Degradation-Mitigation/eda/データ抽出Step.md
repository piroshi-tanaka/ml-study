# EV ãƒãƒƒãƒ†ãƒªåŠ£åŒ–æŠ‘åˆ¶\_æ”¾ç½®äºˆæ¸¬ â€” CodeX è¦ä»¶æ›¸ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

## 0. æ¦‚è¦

- **ç›®çš„**:  
  EV ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå……é›»ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ãŸå¾Œã€ã©ã“ã§é•·æ™‚é–“ï¼ˆâ‰¥6hï¼‰æ”¾ç½®ã™ã‚‹å‚¾å‘ãŒã‚ã‚‹ã‹ã‚’å¯è¦–åŒ–ã—ã€  
  ã€Œå……é›»æ™‚ç‚¹ã§ã®è¡Œå‹•äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã€æ§‹ç¯‰ã«å‘ã‘ãŸ EDA ã‚’è¡Œã†ã€‚  
  ç‰¹ã«ã€å……é›»å‰å¾Œã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„æ™‚é–“å¸¯ãƒ»æ›œæ—¥ãƒ»å……é›»é–‹å§‹æ™‚åˆ»ã®å½±éŸ¿ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ã€‚

- **å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: PoCï¼ˆJupyter ãƒ™ãƒ¼ã‚¹ EDAï¼‰
- **åˆ†æå˜ä½**: `hashvin`ï¼ˆè»Šä¸¡ï¼‰ã”ã¨

---

## 1. ã‚ãªãŸï¼ˆChatGPTï¼‰ã®ãƒ­ãƒ¼ãƒ«

- æ©Ÿæ¢°å­¦ç¿’ãƒ»ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»EV é ˜åŸŸã®å°‚é–€å®¶ã¨ã—ã¦ã€  
  CodeX ã§ã® EDA ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨­è¨ˆãƒ»è‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç”Ÿæˆã‚’æ”¯æ´ã™ã‚‹ã€‚
- Notebook ãƒ¬ãƒ™ãƒ«ã§å†åˆ©ç”¨å¯èƒ½ãª EDA å¯è¦–åŒ–ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹ã€‚

---

## 2. ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ï¼ˆå…¥åŠ›ï¼‰

**1 è¡Œï¼ 1 ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå……é›»ã¾ãŸã¯æ”¾ç½®ï¼‰**

| åˆ—å                                           | èª¬æ˜                           |
| ---------------------------------------------- | ------------------------------ |
| `session_cluster`                              | æ»åœ¨ã‚¯ãƒ©ã‚¹ã‚¿ IDï¼ˆDBSCAN çµæœï¼‰ |
| `session_type`                                 | {`inactive`, `charging`}       |
| `start_time`                                   | æ»åœ¨/å……é›»é–‹å§‹æ™‚åˆ»              |
| `end_time`                                     | æ»åœ¨/å……é›»çµ‚äº†æ™‚åˆ»              |
| `duration_minutes`                             | æ»åœ¨/å……é›»ç¶™ç¶šæ™‚é–“              |
| `start_soc`, `end_soc`, `change_soc`           | SOC é–¢é€£å€¤                     |
| `start_lat`, `start_lon`, `end_lat`, `end_lon` | ä½ç½®åº§æ¨™                       |

**é™¤å¤–æ¡ä»¶**:

- ç§»å‹•ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ãŠã‚ˆã³ã€Œå……é›»ã—ã¦ãã®å ´ã«ç•™ã¾ã‚‹ã€ã‚¤ãƒ™ãƒ³ãƒˆã¯é™¤å¤–æ¸ˆã¿ã€‚

---

## 3. æ´¾ç”Ÿåˆ—ï¼ˆEDA å‡¦ç†ã§è¿½åŠ ï¼‰

| åˆ—å                                | å†…å®¹                                                 |
| ----------------------------------- | ---------------------------------------------------- |
| `weekday`                           | `start_time.dayofweek`ï¼ˆ0=Mon,â€¦,6=Sunï¼‰              |
| `start_hour`                        | `start_time.hour`                                    |
| `is_long_park`                      | `session_type=='inactive'` & `duration_minutes>=360` |
| `prev_session_type`, `prev_cluster` | ç›´å‰ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ï¼ˆshift(+1))                       |
| `next_session_type`, `next_cluster` | ç›´å¾Œã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ï¼ˆshift(-1))                       |
| `after_charge`                      | `inactive`ã‹ã¤`prev_session_type=='charging'`        |
| `charge_start_hour`                 | `start_hour`ï¼ˆå……é›»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ï¼‰                   |
| `date`                              | `start_time.dt.date`ï¼ˆå……é›»æœ‰ç„¡æ—¥æ¯”è¼ƒã«ä½¿ç”¨ï¼‰         |

---

## 4. åˆ†ææ§‹æˆï¼ˆå†è¨­è¨ˆç‰ˆï¼‰

| Step | ãƒ†ãƒ¼ãƒ                 | ç›®çš„                                                        | å‡ºåŠ›å¯è¦–åŒ–                       |
| ---- | ---------------------- | ----------------------------------------------------------- | -------------------------------- |
| 1    | æ”¾ç½®å ´æ‰€åˆ†å¸ƒ           | å„è»Šä¸¡ã®é•·æ™‚é–“æ”¾ç½®ã‚¯ãƒ©ã‚¹ã‚¿å‚¾å‘ã‚’æŠŠæ¡                        | æ£’ã‚°ãƒ©ãƒ•                         |
| 2    | æ»åœ¨å‚¾å‘ï¼‹å……é›»æ™‚åˆ»å½±éŸ¿ | æ›œæ—¥ Ã— æ™‚é–“å¸¯ã®æ»åœ¨å‚¾å‘ï¼‹å……é›»å¾Œåã‚Šï¼‹å……é›»é–‹å§‹æ™‚åˆ»ã«ã‚ˆã‚‹å½±éŸ¿ | ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‹æ¡ä»¶ä»˜ãæ£’ã‚°ãƒ©ãƒ•   |
| 3    | å……é›»å‰å¾Œé·ç§»æ¯”è¼ƒ       | å……é›»å‰å¾Œãƒ»å……é›»æœ‰ç„¡æ—¥åˆ¥ã®è¡Œå‹•é·ç§»å‚¾å‘ã‚’æŠŠæ¡                  | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼‹ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—å·®åˆ† |

---

## 5. Step è©³ç´°ã¨å¯è¦–åŒ–ä»•æ§˜

### ğŸŸ¦ Step 1ï¼šæ”¾ç½®å ´æ‰€ã®å…¨ä½“å‚¾å‘ï¼ˆBar Plotï¼‰

**ç›®çš„**: å„è»Šä¸¡ãŒã©ã®ã‚¯ãƒ©ã‚¹ã‚¿ã§é•·æ™‚é–“æ”¾ç½®ã—ã¦ã„ã‚‹ã‹ã®å…¨ä½“åƒã‚’æŠŠæ¡ã€‚  
**å¯¾è±¡**: `session_type=='inactive'` & `duration_minutes>=360`

- é›†è¨ˆå˜ä½ï¼š`hashvin Ã— session_cluster`
- æŒ‡æ¨™ï¼šç·æ»åœ¨æ™‚é–“[h]
- å‡ºåŠ›ï¼šæ£’ã‚°ãƒ©ãƒ•ï¼ˆé™é †ã€ä¸Šä½ 10 ã‚¯ãƒ©ã‚¹ã‚¿ï¼‰
- æ¬¡å·¥ç¨‹ï¼šä¸Šä½ 5 ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ Step2 ã®å¯è¦–åŒ–å¯¾è±¡ã¨ã™ã‚‹

---

### ğŸŸ© Step 2ï¼šã‚¯ãƒ©ã‚¹ã‚¿åˆ¥ãƒ»æ›œæ—¥ Ã— æ™‚é–“å¸¯ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆå……é›»å¾Œåã‚Šï¼‹å……é›»æ™‚åˆ»å½±éŸ¿ï¼‰

**ç›®çš„**

- ã€Œã©ã®æ™‚é–“å¸¯ãƒ»æ›œæ—¥ã«ã©ã®ã‚¯ãƒ©ã‚¹ã‚¿ã«é•·æ™‚é–“æ»åœ¨ã™ã‚‹ã‹ã€
- ã€Œå……é›»å¾Œã«åã‚‹æ™‚é–“å¸¯ã‚„æ›œæ—¥ã€
- ã€Œå……é›»é–‹å§‹æ™‚åˆ»ãŒæ¬¡æ”¾ç½®å…ˆã«ä¸ãˆã‚‹å½±éŸ¿ã€

**ãƒ‡ãƒ¼ã‚¿**

- é•·æ™‚é–“æ”¾ç½®ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ï¼ˆ`inactive & duration_minutes>=360`ï¼‰
- `after_charge`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ï¼ˆå……é›»å¾Œæ”¾ç½®ã®ã¿æŠ½å‡ºï¼‰

**å‡¦ç†**

1. æ”¾ç½®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ 15 åˆ†ã‚¹ãƒ­ãƒƒãƒˆå±•é–‹ã—ã€`weekdayÃ—hour`ã§æ»åœ¨é›†è¨ˆ
2. ä¸Šä½ 5 ã‚¯ãƒ©ã‚¹ã‚¿ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã® 3 ç¨®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’ä½œæˆ
   - å…¨ä½“æ»åœ¨ï¼ˆAll long inactiveï¼‰
   - å……é›»å¾Œæ»åœ¨ï¼ˆAfter-chargeï¼‰
   - å·®åˆ†ï¼ˆAfter-charge âˆ’ Allï¼‰
3. å……é›»é–‹å§‹æ™‚åˆ»ã®å½±éŸ¿å¯è¦–åŒ–
   - æ¡ä»¶ä»˜ãæ£’ã‚°ãƒ©ãƒ•ï¼š  
     x=`charge_start_hour`ã€y=`P(next_long_park_cluster=c)`  
     facetï¼š`charge_cluster` or `weekday`

---

### ğŸŸ¨ Step 3ï¼šå……é›»å‰å¾Œé·ç§»ã¨å……é›»æœ‰ç„¡æ—¥æ¯”è¼ƒ

#### 3-A. å……é›»å‰ã®é·ç§»ï¼ˆã©ã“ã‹ã‚‰å……é›»ã«æ¥ã‚‹ã‹ï¼‰

- å¯¾è±¡ï¼š`session_type=='charging'`
- ç›´å‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼š`prev_cluster`
- é›†è¨ˆï¼š`P(charge_cluster | prev_cluster, charge_start_hour, weekday)`
- å¯è¦–åŒ–ï¼š
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼ˆprev_cluster â†’ charge_clusterï¼‰
  - ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆx=hour, y=prev_cluster, color=é »åº¦ï¼‰

#### 3-B. å……é›»å¾Œã®é·ç§»ï¼ˆã©ã“ã«æ”¾ç½®ã™ã‚‹ã‹ï¼‰

- å¯¾è±¡ï¼š`charging` â†’ `inactive & is_long_park==1`
- é›†è¨ˆï¼š`P(next_cluster | charge_cluster, charge_start_hour, weekday)`
- å¯è¦–åŒ–ï¼š
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼ˆcharge_cluster â†’ next_long_park_clusterï¼‰
  - ç¢ºç‡æ£’ã‚°ãƒ©ãƒ•ï¼ˆx=hour, y=prob, hue=next_clusterï¼‰

#### 3-C. å……é›»ã‚ã‚Šæ—¥ vs ãªã—æ—¥ ã®æ—¥æ¬¡é·ç§»æ¯”è¼ƒ

- å®šç¾©ï¼š
  - å……é›»ã‚ã‚Šæ—¥ï¼šåŒä¸€`date`å†…ã«`charging`ãŒå­˜åœ¨
  - å……é›»ãªã—æ—¥ï¼šå­˜åœ¨ã—ãªã„æ—¥
- æŠ½å‡ºï¼š
  - æ—¥ã”ã¨ã®`inactive`é·ç§»ï¼ˆ`cluster_i â†’ cluster_j`ï¼‰ã‚’é›†è¨ˆ
- å‡ºåŠ›ï¼š
  1. `T_charge` / `T_nocharge` ã®é·ç§»ç¢ºç‡è¡Œåˆ—ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
  2. å·®åˆ†ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆ`T_charge - T_nocharge`ï¼‰
  3. è·é›¢æŒ‡æ¨™ï¼ˆJensenâ€“Shannon è·é›¢ or TV è·é›¢ï¼‰

---

## 6. å¯è¦–åŒ–ã‚µãƒãƒªè¡¨

| å¯è¦–åŒ–ç¨®åˆ¥               | å¯¾è±¡                              | ç›®çš„                         |
| ------------------------ | --------------------------------- | ---------------------------- |
| æ£’ã‚°ãƒ©ãƒ•                 | é•·æ™‚é–“æ”¾ç½®ã‚¯ãƒ©ã‚¹ã‚¿åˆ†å¸ƒ            | æ”¾ç½®æ‹ ç‚¹ã®æŠŠæ¡               |
| ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ— Ã—3          | ä¸Šä½ 5 ã‚¯ãƒ©ã‚¹ã‚¿ã®å…¨ä½“/å……é›»å¾Œ/å·®åˆ† | æ™‚é–“ãƒ»æ›œæ—¥å‚¾å‘ï¼‹å……é›»å¾Œåã‚Š   |
| æ£’ã‚°ãƒ©ãƒ•ï¼ˆæ¡ä»¶ä»˜ãï¼‰     | å……é›»é–‹å§‹æ™‚åˆ» Ã— æ”¾ç½®ç¢ºç‡           | å……é›»æ™‚åˆ»ã®å½±éŸ¿ç¢ºèª           |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼ˆå……é›»å‰ï¼‰ | prevâ†’charge                       | å……é›»è¡Œå‹•ã®æ–‡è„ˆã‚’æŠŠæ¡         |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼ˆå……é›»å¾Œï¼‰ | chargeâ†’long park                  | å……é›»å¾Œæ”¾ç½®é·ç§»ã®å®šå‹åŒ–ã‚’ç¢ºèª |
| é·ç§»è¡Œåˆ—ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—     | å……é›»ã‚ã‚Š/ãªã—æ—¥æ¯”è¼ƒ               | æ—¥å¸¸è¡Œå‹•ã¸ã®å½±éŸ¿ã‚’ç¢ºèª       |
| å·®åˆ†ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—         | T_chargeâˆ’T_nocharge               | è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³å¤‰åŒ–ã‚’å®šé‡åŒ–     |

---

## 7. å®Ÿè£…è¦ç‚¹ï¼ˆå…±é€šï¼‰

- `groupby('hashvin')`ã§é€æ¬¡ã‚·ãƒ•ãƒˆã—ã€`prev_*`/`next_*`ã‚’ç”Ÿæˆ
- 15 åˆ†ã‚¹ãƒ­ãƒƒãƒˆå±•é–‹ï¼š`pd.date_range(start, end, freq='15T')`
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æç”»ï¼š`networkx`
- å¯è¦–åŒ–ï¼š`matplotlib`, `seaborn`
- ã‚µãƒãƒªæŒ‡æ¨™è¨ˆç®—ï¼š`scipy.spatial.distance.jensenshannon`

---

## 8. å‡ºåŠ›æˆæœç‰©

- å›³è¡¨ï¼š
  - `bar_cluster_distribution.png`
  - `heatmap_cluster_[1-5]_all.png`
  - `heatmap_cluster_[1-5]_aftercharge.png`
  - `heatmap_cluster_[1-5]_diff.png`
  - `network_before_charge.png`
  - `network_after_charge.png`
  - `transition_matrix_diff.png`
- ãƒ†ãƒ¼ãƒ–ãƒ«ï¼š
  - `transition_prob_before.csv`
  - `transition_prob_after.csv`
  - `transition_diff_metrics.csv`

---

## 9. è©•ä¾¡ãƒ»ãƒ¢ãƒ‡ãƒ«æ¥ç¶šæƒ³å®š

EDA ã§ç¢ºèªã•ã‚ŒãŸæ§‹é€ ã‚’ã‚‚ã¨ã«ã€ä»¥ä¸‹ç‰¹å¾´é‡ã‚’æŠ½å‡ºã—ã¦  
æ”¾ç½®å…ˆã‚¯ãƒ©ã‚¹ã‚¿äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã«æ´»ç”¨ã€‚

| ç‰¹å¾´é‡å                                  | èª¬æ˜                 |
| ----------------------------------------- | -------------------- |
| `weekday`, `hour`                         | æ›œæ—¥ãƒ»æ™‚é–“å¸¯         |
| `charge_cluster`, `charge_start_hour`     | å……é›»æ¡ä»¶             |
| `stay_prob_all`, `stay_prob_after_charge` | é€šå¸¸ï¼å……é›»å¾Œæ»åœ¨ç¢ºç‡ |
| `transition_prob_before/after`            | å‰å¾Œé·ç§»ç¢ºç‡         |
| `long_park_ratio`                         | ã‚¯ãƒ©ã‚¹ã‚¿é•·æ™‚é–“æ»åœ¨ç‡ |
| `has_charge_day`                          | ãã®æ—¥ã®å……é›»æœ‰ç„¡     |
| `dist(prev, charge)`                      | ç§»å‹•è·é›¢ç‰¹å¾´ï¼ˆä»»æ„ï¼‰ |

---

## 10. å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] Step1ï¼šã‚¯ãƒ©ã‚¹ã‚¿ã”ã¨ã®æ£’ã‚°ãƒ©ãƒ•ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ˆä¸Šä½ã‚¯ãƒ©ã‚¹ã‚¿é¸å‡ºå¯èƒ½ï¼‰
- [ ] Step2ï¼šä¸Šä½ 5 ã‚¯ãƒ©ã‚¹ã‚¿ã®å…¨ä½“/å……é›»å¾Œ/å·®åˆ†ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‹å……é›»æ™‚åˆ»å½±éŸ¿ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã‚‹
- [ ] Step3ï¼šå……é›»å‰å¾Œã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ï¼‹å……é›»æœ‰ç„¡æ—¥æ¯”è¼ƒã®è¡Œåˆ—ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãŒå‡ºåŠ›ã•ã‚Œã‚‹
- [ ] å·®åˆ†ã‚„è·é›¢æŒ‡æ¨™ãŒè¨ˆç®—ã•ã‚Œã€å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
- [ ] Notebook ã¯`hashvin`å˜ä½ã§åˆ‡æ›¿å¯èƒ½

---

## 11. éã‚¹ã‚³ãƒ¼ãƒ—

- å­¦ç¿’ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ï¼ˆAutoGluon ãªã©ï¼‰ã¯æ¬¡ãƒ•ã‚§ãƒ¼ã‚º
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¨è«–ã€API åŒ–
- äº¤é€šãƒ»å¤©å€™ãƒ»åœ°å›³é€£æº

---

## 12. æˆæœç‰©

- Notebook: `eda_ev_parking_behavior.ipynb`
- å¯è¦–åŒ–ç”»åƒï¼š`/outputs/plots/`
- é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼š`/outputs/tables/`
- Markdown ãƒ¬ãƒãƒ¼ãƒˆï¼š`eda_summary.md`

---
