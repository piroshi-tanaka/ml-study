@startuml
actor User
participant "車両ECU" as ECU
participant "バックエンドML" as BE

== 通常週の開始 ==
User -> ECU : 日常走行\n(SOC徐々に減少)
ECU -> BE : 朝一バッチ推論要求\n(次回=金曜, 次々回=火曜)
BE --> ECU : 通常リコメンド\n(金曜 or スキップ判定)

== 木曜 突発充電 ==
User -> ECU : 木曜夜に充電ケーブル接続
ECU -> BE : オンデマンド推論要求\n(イベント=OPPORTUNISTIC)
BE -> BE : モード判定(条件:通常外タイミング)\n=> OPPORTUNISTIC_CHARGE
BE -> BE : 次回(金曜)/次々回(火曜)までのSOC再予測
BE --> ECU : 「金曜はスキップ可」リコメンド\n(今回充電量の推奨含む)
ECU --> User : アプリ/車載に通知

== 金曜 ==
User -> ECU : 金曜夜、自宅に滞在するが充電せず\n(スキップを受け入れ)
ECU -> BE : ログ送信\n(リコメンド=スキップ, 実際=スキップ)
BE -> BE : 習慣モデル更新\n(単発のOPPORTUNISTICは重み小さめ)

@enduml
