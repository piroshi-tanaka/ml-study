
@startuml
skinparam state {
  BackgroundColor white
  BorderColor black
}

[*] --> COLD_START : 初期状態

COLD_START --> NORMAL : データ量が閾値以上
COLD_START --> TRAVEL : 長距離/未知場所で急に利用開始

NORMAL --> TRAVEL : 長距離走行/未知クラスタが継続
TRAVEL --> NORMAL : 一定期間、平常パターンに回帰

' 緊急事態：通常の充電タイミング前に残量不足
NORMAL --> EMERGENCY_BEFORE_NORMAL : SOCが予測より急減
TRAVEL --> EMERGENCY_BEFORE_NORMAL : 旅行中でもSOCが危険値

' 突発的な充電（余裕SOCだが充電イベント発生）
NORMAL --> OPPORTUNISTIC_CHARGE : 通常外のタイミングで充電開始
TRAVEL --> OPPORTUNISTIC_CHARGE : 旅行中の突発充電
OPPORTUNISTIC_CHARGE --> NORMAL : 充電完了後、平常パターンに復帰可能と判断
OPPORTUNISTIC_CHARGE --> TRAVEL : 旅行パターン継続と判断

EMERGENCY_BEFORE_NORMAL --> NORMAL : 緊急充電完了 & 通常パターンに戻る
EMERGENCY_BEFORE_NORMAL --> TRAVEL : 旅行中の緊急対応と判断

' トリガー例（ノート）
state NORMAL {
  note right
    主な推論トリガー:
    - 朝一バッチ
    - 車両/アプリ起動時
  end note
}

state EMERGENCY_BEFORE_NORMAL {
  note right
    主な推論トリガー:
    - SOC閾値下回り検知
    - 充電ケーブル接続
    - アプリ「今から充電」ボタン
  end note
}
@enduml
