@startuml
title 3. Monitor Trigger (SOC監視・緊急介入)

start
:車載ECU: 連続監視を開始 (SOC, SOC減少速度, バッテリSOH);

repeat
  :予測減少速度と実減少速度の乖離をチェック;
  if (実減少速度 > 予測減少速度 * 乖離閾値?) then (乖離あり)
    :安全ステータスを `YELLOW` へ遷移;
    :サーバーへ再計算を要求/警告ログ送信;
    :レベル3アクション: 早期充電リマインド、ナビ誘導を提案;
  endif

  :SOCが緊急閾値 (例: 10%) を下回ったか?;
  if (はい) then (緊急)
    :安全ステータスを `RED` へ遷移;
    :すべての最適化リコメンドを上書き停止;
    :レベル3アクション: 🚨 即時充電指令、最短スポットへの強制ナビ誘導;
    break
  endif
repeat while (走行/電源ON状態が継続)

stop
@enduml
